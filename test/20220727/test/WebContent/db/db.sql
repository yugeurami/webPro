DROP TABLE MONEY;
DROP TABLE MEMBER;
DROP SEQUENCE MEMBER_SEQ;
DROP SEQUENCE MONEY_SEQ;
CREATE TABLE MEMBER(
    CUSTNO       NUMBER(5) PRIMARY KEY,
    CUSTNAME    VARCHAR2(20),
    PHONE          VARCHAR(20),
    ADDRESS       VARCHAR2(60),
    JOINDATE      DATE,
    GRADE         CHAR(1),
    CITY            CHAR(2) );


CREATE SEQUENCE MEMBER_SEQ START WITH 1001 MAXVALUE 99999 NOCACHE NOCYCLE;

INSERT INTO MEMBER
    VALUES(MEMBER_SEQ.NEXTVAL, '홍길동', '010-1111-2222', '서울 동대문구', '2022-07-02', 'A', '01');
INSERT INTO MEMBER
    VALUES(MEMBER_SEQ.NEXTVAL, '신길동', '010-1111-3333', '서울 강남구', '2022-06-01', 'B', '01');
INSERT INTO MEMBER
    VALUES(MEMBER_SEQ.NEXTVAL, '김길동', '010-1111-4444', '경기도 안양시', '2022-05-01', 'B', '30');
INSERT INTO MEMBER
    VALUES(MEMBER_SEQ.NEXTVAL, '유길동', '010-1111-5555', '경기도 의정부시', '2022-07-03', 'A', '30');
INSERT INTO MEMBER
    VALUES(MEMBER_SEQ.NEXTVAL, '정길동', '010-1111-6666', '서울 용산구', '2022-07-03', 'B', '60');
COMMIT;

CREATE TABLE MONEY(
    SALENO  NUMBER(6) PRIMARY KEY,
    CUSTNO   NUMBER(5) REFERENCES MEMBER(CUSTNO),
    COST      NUMBER(8),
    AMOUNT  NUMBER(4),
    PRICE       NUMBER(8),
    PCODE     VARCHAR2(4),
    SDATE     DATE  );

CREATE SEQUENCE MONEY_SEQ START WITH 202201 MAXVALUE 999999 NOCACHE NOCYCLE;
    
INSERT INTO MONEY
    VALUES(MONEY_SEQ.NEXTVAL, 1001, 100, 20, 2000, 'A01', '2022-07-01');
INSERT INTO MONEY
    VALUES(MONEY_SEQ.NEXTVAL, 1001, 150, 20, 3000, 'A02', '2022-07-01');
INSERT INTO MONEY
    VALUES(MONEY_SEQ.NEXTVAL, 1002, 200, 10, 2000, 'A03', '2022-07-01');
INSERT INTO MONEY
    VALUES(MONEY_SEQ.NEXTVAL, 1003, 100, 5, 500, 'A01', '2022-07-01');
INSERT INTO MONEY
    VALUES(MONEY_SEQ.NEXTVAL, 1004, 100, 9, 900, 'A01', '2022-07-02');
INSERT INTO MONEY
    VALUES(MONEY_SEQ.NEXTVAL, 1003, 150, 6, 900, 'A02', '2022-07-03');
INSERT INTO MONEY
    VALUES(MONEY_SEQ.NEXTVAL, 1001, 200, 2, 400, 'A03', '2022-07-04');
COMMIT;


-- 회원 목록 조회
SELECT * FROM MEMBER;

-- 회원 번호 불러오기
SELECT MAX(CUSTNO)+1 NOWNO FROM MEMBER;

-- 회원 등록
INSERT INTO MEMBER (CUSTNO, CUSTNAME, PHONE, ADDRESS, JOINDATE, GRADE, CITY)
    VALUES(MEMBER_SEQ.NEXTVAL, '정길동', '010-1111-6666', '서울 용산구', '2022-07-03', 'B', '60');
    
-- 회원 상세보기
SELECT * FROM MEMBER WHERE CUSTNO = 1001;

-- 회원 정보 수정
UPDATE MEMBER
    SET CUSTNAME = '정길동', 
          PHONE = '010-1111-6666', 
          ADDRESS = '서울 용산구', 
          JOINDATE = '2022.07.03', 
          GRADE = 'B', 
          CITY = '60'
    WHERE CUSTNO = 1005;
    
-- 회원 매출 조회
SELECT M.CUSTNO, CUSTNAME, GRADE, ALLPRICE
    FROM MEMBER M, (SELECT CUSTNO, SUM(PRICE) ALLPRICE FROM MONEY GROUP BY CUSTNO) B
    WHERE M.CUSTNO=B.CUSTNO
    ORDER BY ALLPRICE DESC;
    
-- 제품 매출 조회
SELECT PCODE, SUM(PRICE) ALLPRICE FROM MONEY 
    GROUP BY PCODE
    ORDER BY ALLPRICE DESC;
